<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Принтер</title>
<style>
body{margin:0;background:#1e1e1e;color:#fff;font-family:Arial,sans-serif;opacity:0;transform:translateX(40px);animation:pageEnter 0.25s forwards ease-out;}
@keyframes pageEnter{from{opacity:0;transform:translateX(40px);}to{opacity:1;transform:translateX(0);} }
.header{display:flex;align-items:center;gap:16px;padding:16px;}
.back-btn{background:#2e2e2e;color:#fff;border:none;border-radius:12px;padding:20px;font-size:18px;font-weight:bold;cursor:pointer;}
.back-btn:active{transform:scale(0.95);}
.title{font-size:32px;font-weight:bold;}
.top-block{display:flex;gap:16px;padding:0 16px;}
.photo-block{width:50%;}
.photo-block img{width:100%;height:auto;border-radius:7px;object-fit:contain;}
.info-block{width:50%;background:#2a2a2a;border-radius:7px;padding:16px;}
.model-label{font-size:18px;opacity:0.7;}
.model-value{font-size:20px;font-weight:bold;white-space:nowrap;}
.status-block{margin:24px 16px;background:#2a2a2a;border-radius:7px;padding:20px;}
.status-row{display:grid;grid-template-columns:140px 1fr;align-items:center;margin-bottom:12px;}
.status-label{background:#242424;border-radius:6px;padding:6px 10px;font-size:18px;opacity:0.85;}
.status-value{font-size:22px;padding-left:12px;}
.progress{margin-top:16px;height:18px;background:#444;border-radius:9px;overflow:hidden;}
.progress-bar{height:100%;width:0%;transition:width 0.3s;}
.color-block{margin:0 16px 24px;background:#2a2a2a;border-radius:7px;padding:20px;}
.color-options{display:grid;grid-template-columns:repeat(3,1fr);gap:16px;margin-top:16px;} /* ровные зазоры */
.color-circle{width:40px;height:40px;border-radius:50%;cursor:pointer;}
.control-block{display:flex;justify-content:space-between;margin:0 16px 24px;}
button.control-btn{flex:1;margin:0 8px;padding:20px;font-size:20px;font-weight:bold;border:none;border-radius:12px;cursor:pointer;}
button#start{background:#4caf50;color:#fff;}
button#stop{background:#f44336;color:#fff;}
button.disabled{opacity:0.5;cursor:default;}
</style>
</head>
<body>

<div class="header">
  <button class="back-btn" onclick="goBack()">←</button>
  <div class="title">Принтер 1</div>
</div>

<div class="top-block">
  <div class="photo-block"><img src="foto/1.png" alt="Bambu Lab A1"></div>
  <div class="info-block">
    <div class="model-label">Модель</div>
    <div class="model-value">Bambu Lab A1</div>
  </div>
</div>

<div class="status-block">
  <div class="status-row">
    <div class="status-label">Статус</div>
    <div class="status-value" id="status-text">Простаивает</div>
  </div>
  <div class="status-row">
    <div class="status-label">Печать</div>
    <div class="status-value" id="print-name">—</div>
  </div>
  <div class="status-row">
    <div class="status-label">Готово</div>
    <div class="status-value" id="progress-text">0%</div>
  </div>
  <div class="progress"><div class="progress-bar" id="progress-bar"></div></div>
</div>

<div class="color-block">
  <div>Выберите цвет печати</div>
  <div class="color-options" id="color-options">
    <div class="color-circle" style="background:red" data-color="red"></div>
    <div class="color-circle" style="background:blue" data-color="blue"></div>
    <div class="color-circle" style="background:yellow" data-color="yellow"></div>
    <div class="color-circle" style="background:green" data-color="green"></div>
    <div class="color-circle" style="background:white" data-color="white"></div>
    <div class="color-circle" style="background:orange" data-color="orange"></div>
    <div class="color-circle" style="background:purple" data-color="purple"></div>
    <div class="color-circle" style="background:pink" data-color="pink"></div>
    <div class="color-circle" style="background:brown" data-color="brown"></div>
  </div>
</div>

<script>
const statusText = document.getElementById("status-text");
const printNameText = document.getElementById("print-name");
const progressText = document.getElementById("progress-text");
const progressBar = document.getElementById("progress-bar");
const colorCircles = document.querySelectorAll(".color-circle");

function getPrinterData() {
  return {
    status: localStorage.getItem("printerStatus") || "idle",
    printName: localStorage.getItem("printerPrintName") || "",
    totalSeconds: parseInt(localStorage.getItem("printerTotalSeconds")) || 0,
    startTime: parseInt(localStorage.getItem("printerStartTime")) || 0,
    savedPercent: parseInt(localStorage.getItem("printerSavedPercent")) || 0,
    color: localStorage.getItem("printerColor") || "red"
  };
}

function savePrinterData(printer){
  localStorage.setItem("printerStatus", printer.status);
  localStorage.setItem("printerPrintName", printer.printName);
  localStorage.setItem("printerTotalSeconds", printer.totalSeconds);
  localStorage.setItem("printerStartTime", printer.startTime);
  localStorage.setItem("printerSavedPercent", printer.savedPercent);
  localStorage.setItem("printerColor", printer.color);
}

function updateUI(){
  let printer = getPrinterData();
  let elapsed = 0;
  const now = Date.now();

  if(printer.status==="printing"){
    elapsed = Math.floor((now - printer.startTime)/1000);
    if(elapsed >= printer.totalSeconds){
      printer.status="idle";
      elapsed = printer.totalSeconds;
      savePrinterData(printer);
    }
  } else if(printer.status==="stopped"){
    elapsed = Math.floor(printer.totalSeconds * printer.savedPercent / 100);
  }

  statusText.textContent = printer.status==="idle"?"Простаивает":printer.status==="printing"?"Печать":"Печать остановлена";
  printNameText.textContent = printer.printName || "—";

  let percent = printer.totalSeconds ? Math.floor((elapsed/printer.totalSeconds)*100) : 0;
  progressText.textContent = percent+"%";
  progressBar.style.width = percent+"%";
  progressBar.style.background = printer.status==="stopped"?"orange":"#4caf50";
}

updateUI();
setInterval(updateUI,1000);

// ===== Выбор цвета =====
colorCircles.forEach(c=>{
  c.onclick = ()=>{
    const color = c.dataset.color;
    let printer = getPrinterData();
    printer.color=color;
    savePrinterData(printer);
    updateUI();
  }
});

function goBack(){document.body.style.animation="pageExit 0.2s forwards ease-in"; setTimeout(()=>history.back(),200);}
</script>

</body>
</html>
