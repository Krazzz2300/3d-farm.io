<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–Ω—Ç–µ—Ä–æ–º</title>
<style>
* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
  -webkit-tap-highlight-color: transparent;
}

body {
  background: #1e1e1e;
  color: #fff;
  font-family: Arial, sans-serif;
  animation: fadeIn 0.3s ease-out;
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

.header {
  background: #2a2a2a;
  padding: 15px;
  display: flex;
  align-items: center;
  gap: 12px;
  position: sticky;
  top: 0;
  z-index: 10;
}

.back-btn {
  background: #333;
  color: white;
  border: none;
  border-radius: 10px;
  padding: 12px;
  font-size: 20px;
  cursor: pointer;
  width: 48px;
  height: 48px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.back-btn:active {
  background: #444;
  transform: scale(0.95);
}

.title {
  font-size: 22px;
  font-weight: bold;
  flex: 1;
}

.content {
  padding: 15px;
}

.printer-image {
  width: 100%;
  height: 200px;
  border-radius: 12px;
  object-fit: contain;
  background: #2a2a2a;
  margin-bottom: 15px;
  padding: 10px;
}

.info-box {
  background: #2a2a2a;
  border-radius: 12px;
  padding: 20px;
  margin-bottom: 15px;
}

.info-row {
  display: flex;
  justify-content: space-between;
  margin-bottom: 12px;
  font-size: 17px;
}

.info-label {
  color: #aaa;
}

.info-value {
  font-weight: bold;
  text-align: right;
  max-width: 60%;
}

.progress-container {
  margin-top: 20px;
}

.progress-bar-bg {
  height: 24px;
  background: #444;
  border-radius: 12px;
  overflow: hidden;
  margin-top: 8px;
  position: relative;
}

.progress-bar {
  height: 100%;
  background: #4caf50;
  transition: width 0.5s ease;
  border-radius: 12px;
}

.progress-text {
  position: absolute;
  left: 0;
  right: 0;
  text-align: center;
  line-height: 24px;
  font-weight: bold;
  font-size: 14px;
  text-shadow: 1px 1px 1px rgba(0,0,0,0.5);
}

.controls {
  display: flex;
  flex-direction: column;
  gap: 10px;
  margin-top: 20px;
}

.control-btn {
  padding: 18px;
  border-radius: 12px;
  border: none;
  font-size: 18px;
  font-weight: bold;
  cursor: pointer;
  transition: transform 0.2s, opacity 0.2s;
}

.control-btn:active {
  transform: scale(0.98);
  opacity: 0.9;
}

.start-btn { 
  background: #4caf50; 
  color: white; 
}

.stop-btn { 
  background: #f44336; 
  color: white; 
}

.repair-btn { 
  background: orange; 
  color: white; 
}

.disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.disabled:active {
  transform: none;
  opacity: 0.5;
}

.color-selector {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 10px;
  margin: 15px 0;
}

.color-option {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  cursor: pointer;
  border: 3px solid transparent;
}

.color-option.selected {
  border-color: white;
}

.color-option:active {
  transform: scale(0.9);
}

.modal-bg {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.85);
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 1000;
  padding: 15px;
}

.modal {
  background: #2a2a2a;
  padding: 20px;
  border-radius: 16px;
  width: 100%;
  max-width: 340px;
}

.modal input {
  width: 100%;
  padding: 12px;
  margin: 10px 0;
  border-radius: 10px;
  border: 2px solid #444;
  background: #1e1e1e;
  color: white;
  font-size: 16px;
}

.modal-buttons {
  display: flex;
  gap: 10px;
  margin-top: 20px;
}

.modal-buttons button {
  flex: 1;
  padding: 12px;
  border-radius: 10px;
  border: none;
  font-size: 16px;
  font-weight: bold;
  cursor: pointer;
}

.cancel-btn { background: #666; color: white; }
.ok-btn { background: #4caf50; color: white; }

@keyframes pulse {
  0% { background-color: #4caf50; }
  50% { background-color: #00ff00; }
  100% { background-color: #4caf50; }
}

.pulse-animation {
  animation: pulse 1s infinite;
}
</style>
</head>
<body>

<div class="header">
  <button class="back-btn" onclick="goBack()">‚Üê</button>
  <div class="title" id="printer-title">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
</div>

<div class="content">
  <img id="printer-image" class="printer-image" src="" alt="–ü—Ä–∏–Ω—Ç–µ—Ä">
  
  <div class="info-box">
    <div class="info-row">
      <div class="info-label">–°—Ç–∞—Ç—É—Å:</div>
      <div class="info-value" id="status-text">‚Äî</div>
    </div>
    <div class="info-row">
      <div class="info-label">–ú–æ–¥–µ–ª—å:</div>
      <div class="info-value" id="model-text">‚Äî</div>
    </div>
    <div class="info-row">
      <div class="info-label">–ü–µ—á–∞—Ç–∞–µ—Ç:</div>
      <div class="info-value" id="print-text">‚Äî</div>
    </div>
    <div class="info-row">
      <div class="info-label">–¶–≤–µ—Ç –ø–µ—á–∞—Ç–∏:</div>
      <div class="info-value">
        <div id="current-color" style="display:inline-block; width:20px; height:20px; border-radius:50%; vertical-align:middle; margin-left:8px;"></div>
      </div>
    </div>
    
    <div class="progress-container">
      <div class="info-row">
        <div class="info-label">–ü—Ä–æ–≥—Ä–µ—Å—Å:</div>
        <div class="info-value" id="progress-text">0%</div>
      </div>
      <div class="progress-bar-bg">
        <div class="progress-bar" id="progress-bar"></div>
        <div class="progress-text" id="progress-bar-text">0%</div>
      </div>
    </div>
  </div>
  
  <div class="controls">
    <button id="start-btn" class="control-btn start-btn">–ù–∞—á–∞—Ç—å –ø–µ—á–∞—Ç—å</button>
    <button id="stop-btn" class="control-btn stop-btn disabled">–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–µ—á–∞—Ç—å</button>
    <button id="repair-btn" class="control-btn repair-btn">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ —Ä–µ–º–æ–Ω—Ç</button>
  </div>
  
  <div style="margin-top: 20px; text-align: center;">
    <button class="control-btn" style="background:#666; color:white;" onclick="deleteThisPrinter()">–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –ø—Ä–∏–Ω—Ç–µ—Ä</button>
  </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –Ω–∞—á–∞–ª–∞ –ø–µ—á–∞—Ç–∏ -->
<div class="modal-bg" id="print-modal">
  <div class="modal">
    <h3 style="text-align:center; margin-bottom:15px;">–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—á–∞—Ç–∏</h3>
    
    <input type="text" id="print-name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –¥–µ—Ç–∞–ª–∏" value="–î–µ—Ç–∞–ª—å">
    <input type="number" id="print-time" placeholder="–í—Ä–µ–º—è –ø–µ—á–∞—Ç–∏ (—Å–µ–∫)" value="60">
    
    <div style="margin:15px 0;">
      <div style="margin-bottom:8px; color:#aaa;">–¶–≤–µ—Ç –ø–µ—á–∞—Ç–∏:</div>
      <div class="color-selector" id="color-selector">
        <!-- –¶–≤–µ—Ç–∞ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ JS -->
      </div>
    </div>
    
    <div class="modal-buttons">
      <button class="cancel-btn" onclick="closePrintModal()">–û—Ç–º–µ–Ω–∞</button>
      <button class="ok-btn" onclick="confirmPrint()">–ù–∞—á–∞—Ç—å –ø–µ—á–∞—Ç—å</button>
    </div>
  </div>
</div>

<script>
// ===== –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï =====
const STORAGE_KEY = '3d_printer_farm_data';
const urlParams = new URLSearchParams(window.location.search);
const printerId = urlParams.get('id') || 'printer1';
let updateInterval;

// –¶–≤–µ—Ç–∞ –¥–ª—è –ø–µ—á–∞—Ç–∏
const PRINT_COLORS = [
  'red', 'blue', 'green', 'yellow', 'orange', 
  'purple', 'pink', 'black', 'white', 'gray'
];

// ===== –†–ê–ë–û–¢–ê –° –î–ê–ù–ù–´–ú–ò =====

function getPrinters() {
  try {
    const savedData = localStorage.getItem(STORAGE_KEY);
    return savedData ? JSON.parse(savedData) : [];
  } catch (error) {
    console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö:", error);
    return [];
  }
}

function savePrinters(printers) {
  try {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(printers));
    return true;
  } catch (error) {
    console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏:", error);
    return false;
  }
}

function getCurrentPrinter() {
  const printers = getPrinters();
  return printers.find(p => p.id === printerId) || null;
}

function updatePrinter(updatedData) {
  const printers = getPrinters();
  const index = printers.findIndex(p => p.id === printerId);
  
  if (index !== -1) {
    printers[index] = { ...printers[index], ...updatedData };
    return savePrinters(printers);
  }
  
  return false;
}

// ===== –û–ë–ù–û–í–õ–ï–ù–ò–ï –ü–†–û–ì–†–ï–°–°–ê –ü–ï–ß–ê–¢–ò =====

function updatePrintProgress() {
  const printer = getCurrentPrinter();
  
  if (!printer) return false;
  
  let updated = false;
  
  if (printer.status === 'printing' && printer.startTime && printer.printDuration) {
    const now = Date.now();
    const elapsed = now - printer.startTime;
    const progress = Math.min(100, Math.floor((elapsed / printer.printDuration) * 100));
    
    if (progress !== printer.progress) {
      printer.progress = progress;
      
      if (progress >= 100) {
        printer.status = 'finished';
        printer.finishedNotified = false;
        showNotificationOnPage('‚úÖ –ü–µ—á–∞—Ç—å –∑–∞–≤–µ—Ä—à–µ–Ω–∞!');
      }
      
      updatePrinter(printer);
      updated = true;
    }
  }
  
  if (updated || document.hidden) {
    // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–∞–∂–µ –µ—Å–ª–∏ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–µ–∞–∫—Ç–∏–≤–Ω–∞
    updatePrinterUI(printer);
  }
  
  return updated;
}

// ===== –û–ë–ù–û–í–õ–ï–ù–ò–ï –ò–ù–¢–ï–†–§–ï–ô–°–ê =====

function updatePrinterUI(printer) {
  if (!printer) return;
  
  // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–ª—è
  document.getElementById('printer-title').textContent = printer.name;
  document.getElementById('model-text').textContent = printer.model;
  document.getElementById('print-text').textContent = printer.printName || '‚Äî';
  document.getElementById('progress-text').textContent = printer.progress + '%';
  
  // –°—Ç–∞—Ç—É—Å —Å —Ü–≤–µ—Ç–æ–º
  const statusText = getStatusText(printer.status);
  const statusColor = getStatusColor(printer.status);
  document.getElementById('status-text').textContent = statusText;
  document.getElementById('status-text').style.color = statusColor;
  
  // –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä
  const progressBar = document.getElementById('progress-bar');
  const progressBarText = document.getElementById('progress-bar-text');
  progressBar.style.width = printer.progress + '%';
  progressBarText.textContent = printer.progress + '%';
  
  // –¶–≤–µ—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–∞ –∏ –∞–Ω–∏–º–∞—Ü–∏—è
  const progressColor = getProgressColor(printer.status);
  progressBar.style.background = progressColor;
  
  if (printer.status === 'finished' && (!printer.finishedNotified || printer.finishedNotified === undefined)) {
    progressBar.classList.add('pulse-animation');
  } else {
    progressBar.classList.remove('pulse-animation');
  }
  
  // –¶–≤–µ—Ç –ø–µ—á–∞—Ç–∏
  const currentColorEl = document.getElementById('current-color');
  currentColorEl.style.background = printer.color || 'gray';
  
  // –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø—Ä–∏–Ω—Ç–µ—Ä–∞
  const imageEl = document.getElementById('printer-image');
  imageEl.src = printer.image || 'foto/default.png';
  imageEl.onerror = function() {
    this.src = 'foto/default.png';
  };
  
  // –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
  const startBtn = document.getElementById('start-btn');
  const stopBtn = document.getElementById('stop-btn');
  const repairBtn = document.getElementById('repair-btn');
  
  // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–Ω–æ–ø–æ–∫
  startBtn.disabled = printer.status === 'printing' || printer.status === 'repair';
  stopBtn.disabled = printer.status !== 'printing';
  
  if (printer.status === 'repair') {
    repairBtn.textContent = '–°–Ω—è—Ç—å —Å —Ä–µ–º–æ–Ω—Ç–∞';
    startBtn.classList.add('disabled');
    stopBtn.classList.add('disabled');
  } else {
    repairBtn.textContent = '–û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ —Ä–µ–º–æ–Ω—Ç';
    startBtn.classList.remove('disabled');
    stopBtn.classList.remove('disabled');
  }
  
  // –°—Ç–∏–ª–∏ –¥–ª—è disabled –∫–Ω–æ–ø–æ–∫
  if (startBtn.disabled) {
    startBtn.classList.add('disabled');
  } else {
    startBtn.classList.remove('disabled');
  }
  
  if (stopBtn.disabled) {
    stopBtn.classList.add('disabled');
  } else {
    stopBtn.classList.remove('disabled');
  }
}

// ===== –£–ü–†–ê–í–õ–ï–ù–ò–ï –ü–ï–ß–ê–¢–¨–Æ =====

function openPrintModal() {
  const printer = getCurrentPrinter();
  if (!printer || printer.status === 'repair') return;
  
  // –ó–∞–ø–æ–ª–Ω—è–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
  document.getElementById('print-name').value = printer.printName || '–î–µ—Ç–∞–ª—å';
  document.getElementById('print-time').value = '60';
  
  // –°–æ–∑–¥–∞–µ–º –≤—ã–±–æ—Ä —Ü–≤–µ—Ç–∞
  const colorSelector = document.getElementById('color-selector');
  colorSelector.innerHTML = '';
  
  PRINT_COLORS.forEach(color => {
    const colorOption = document.createElement('div');
    colorOption.className = `color-option ${printer.color === color ? 'selected' : ''}`;
    colorOption.style.background = color;
    colorOption.dataset.color = color;
    colorOption.onclick = function() {
      // –°–Ω–∏–º–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Å–æ –≤—Å–µ—Ö
      document.querySelectorAll('.color-option').forEach(el => {
        el.classList.remove('selected');
      });
      // –í—ã–¥–µ–ª—è–µ–º —Ç–µ–∫—É—â–∏–π
      this.classList.add('selected');
    };
    colorSelector.appendChild(colorOption);
  });
  
  document.getElementById('print-modal').style.display = 'flex';
  document.getElementById('print-name').focus();
}

function closePrintModal() {
  document.getElementById('print-modal').style.display = 'none';
}

function confirmPrint() {
  const printName = document.getElementById('print-name').value.trim();
  const printTime = parseInt(document.getElementById('print-time').value);
  const selectedColor = document.querySelector('.color-option.selected')?.dataset.color || 'red';
  
  if (!printName || isNaN(printTime) || printTime <= 0) {
    alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ');
    return;
  }
  
  const printer = getCurrentPrinter();
  if (!printer) return;
  
  // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏–Ω—Ç–µ—Ä–∞
  const updatedPrinter = {
    ...printer,
    status: 'printing',
    printName: printName,
    progress: 0,
    startTime: Date.now(),
    printDuration: printTime * 1000,
    color: selectedColor,
    finishedNotified: false
  };
  
  if (updatePrinter(updatedPrinter)) {
    closePrintModal();
    updatePrinterUI(updatedPrinter);
    showNotificationOnPage('üñ®Ô∏è –ü–µ—á–∞—Ç—å –Ω–∞—á–∞—Ç–∞!');
  }
}

function stopPrint() {
  const printer = getCurrentPrinter();
  if (!printer || printer.status !== 'printing') return;
  
  if (confirm('–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–µ—á–∞—Ç—å?')) {
    printer.status = 'stopped';
    if (updatePrinter(printer)) {
      updatePrinterUI(printer);
      showNotificationOnPage('‚è∏Ô∏è –ü–µ—á–∞—Ç—å –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞');
    }
  }
}

function toggleRepair() {
  const printer = getCurrentPrinter();
  if (!printer) return;
  
  if (printer.status !== 'repair') {
    const reason = prompt('–ü—Ä–∏—á–∏–Ω–∞ —Ä–µ–º–æ–Ω—Ç–∞:', '–ù–µ–∏—Å–ø—Ä–∞–≤–Ω–æ—Å—Ç—å —ç–∫—Å—Ç—Ä—É–¥–µ—Ä–∞');
    if (reason === null) return;
    
    printer.status = 'repair';
    printer.problem = reason;
    printer.progress = 100;
    printer.printName = '';
    
    if (updatePrinter(printer)) {
      updatePrinterUI(printer);
      showNotificationOnPage('üîß –ü—Ä–∏–Ω—Ç–µ—Ä –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –≤ —Ä–µ–º–æ–Ω—Ç');
    }
  } else {
    printer.status = 'idle';
    printer.problem = '';
    printer.progress = 0;
    printer.printName = '';
    
    if (updatePrinter(printer)) {
      updatePrinterUI(printer);
      showNotificationOnPage('‚úÖ –ü—Ä–∏–Ω—Ç–µ—Ä —Å–Ω—è—Ç —Å —Ä–µ–º–æ–Ω—Ç–∞');
    }
  }
}

function deleteThisPrinter() {
  if (confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –ø—Ä–∏–Ω—Ç–µ—Ä? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.')) {
    const printers = getPrinters();
    const updatedPrinters = printers.filter(p => p.id !== printerId);
    
    if (savePrinters(updatedPrinters)) {
      showNotificationOnPage('üóëÔ∏è –ü—Ä–∏–Ω—Ç–µ—Ä —É–¥–∞–ª–µ–Ω');
      setTimeout(() => {
        window.location.href = 'index.html';
      }, 1000);
    }
  }
}

// ===== –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò =====

function getStatusText(status) {
  const statusMap = {
    'idle': '–ü—Ä–æ—Å—Ç–∞–∏–≤–∞–µ—Ç',
    'printing': '–ü–µ—á–∞—Ç—å...',
    'stopped': '–û—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ',
    'finished': '–ì–æ—Ç–æ–≤–æ!',
    'repair': '–ù–∞ —Ä–µ–º–æ–Ω—Ç–µ'
  };
  return statusMap[status] || status;
}

function getStatusColor(status) {
  const colorMap = {
    'idle': '#fff',
    'printing': '#4caf50',
    'stopped': 'orange',
    'finished': '#4caf50',
    'repair': 'red'
  };
  return colorMap[status] || '#fff';
}

function getProgressColor(status) {
  const colorMap = {
    'idle': '#444',
    'printing': '#4caf50',
    'stopped': 'orange',
    'finished': '#4caf50',
    'repair': 'red'
  };
  return colorMap[status] || '#444';
}

function showNotificationOnPage(message) {
  // –°–æ–∑–¥–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
  const notification = document.createElement('div');
  notification.textContent = message;
  notification.style.cssText = `
    position: fixed;
    top: 70px;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(76, 175, 80, 0.9);
    color: white;
    padding: 12px 24px;
    border-radius: 10px;
    z-index: 1000;
    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    animation: slideIn 0.3s ease-out;
    font-weight: bold;
    backdrop-filter: blur(10px);
  `;
  
  document.body.appendChild(notification);
  
  // –£–¥–∞–ª—è–µ–º —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
  setTimeout(() => {
    notification.style.animation = 'slideOut 0.3s ease-out';
    setTimeout(() => {
      if (notification.parentNode) {
        document.body.removeChild(notification);
      }
    }, 300);
  }, 3000);
}

// –î–æ–±–∞–≤–ª—è–µ–º –∞–Ω–∏–º–∞—Ü–∏–∏
const style = document.createElement('style');
style.textContent = `
  @keyframes slideIn {
    from { transform: translateX(-50%) translateY(-20px); opacity: 0; }
    to { transform: translateX(-50%) translateY(0); opacity: 1; }
  }
  @keyframes slideOut {
    from { transform: translateX(-50%) translateY(0); opacity: 1; }
    to { transform: translateX(-50%) translateY(-20px); opacity: 0; }
  }
`;
document.head.appendChild(style);

function goBack() {
  window.location.href = 'index.html';
}

// ===== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø =====

document.addEventListener('DOMContentLoaded', function() {
  // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏–Ω—Ç–µ—Ä–∞
  const printer = getCurrentPrinter();
  if (!printer) {
    alert('–ü—Ä–∏–Ω—Ç–µ—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω!');
    window.location.href = 'index.html';
    return;
  }
  
  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
  updatePrinterUI(printer);
  
  // –ù–∞–∑–Ω–∞—á–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫
  document.getElementById('start-btn').onclick = openPrintModal;
  document.getElementById('stop-btn').onclick = stopPrint;
  document.getElementById('repair-btn').onclick = toggleRepair;
  
  // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
  document.getElementById('print-modal').addEventListener('click', function(e) {
    if (e.target === this) {
      closePrintModal();
    }
  });
  
  // –ó–∞–ø—É—Å–∫–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
  updateInterval = setInterval(updatePrintProgress, 1000);
  
  // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å –¥–∞–∂–µ –∫–æ–≥–¥–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–µ–∞–∫—Ç–∏–≤–Ω–∞
  document.addEventListener('visibilitychange', function() {
    if (!document.hidden) {
      updatePrintProgress();
    }
  });
});

// –û—á–∏—â–∞–µ–º –∏–Ω—Ç–µ—Ä–≤–∞–ª –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
window.addEventListener('beforeunload', function() {
  if (updateInterval) {
    clearInterval(updateInterval);
  }
});

// –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
window.goBack = goBack;
window.openPrintModal = openPrintModal;
window.closePrintModal = closePrintModal;
window.confirmPrint = confirmPrint;
window.stopPrint = stopPrint;
window.toggleRepair = toggleRepair;
window.deleteThisPrinter = deleteThisPrinter;
</script>

</body>
</html>