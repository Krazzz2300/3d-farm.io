<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Ферма принтеров</title>
<style>
body { margin:0; background:#1e1e1e; font-family: Arial,sans-serif; color:#fff; }
.container { display: flex; flex-wrap: wrap; gap:32px; padding:16px; justify-content: center; }
.card {
  background:#2a2a2a;
  border-radius: 7px;
  width:45%;
  min-width:140px;
  padding:12px;
  cursor:pointer;
  transition: transform 0.15s;
}
.card:active { transform: scale(0.97); }
.card img { width:100%; border-radius:7px; object-fit:contain; }
.card-title { font-size:20px; font-weight:bold; margin-top:8px; }
.status-row { display:flex; justify-content: space-between; margin-top:8px; font-size:16px; }
.progress { margin-top:8px; height:18px; background:#444; border-radius:9px; overflow:hidden; }
.progress-bar { height:100%; width:0%; background:#4caf50; transition: width 0.3s; }
</style>
</head>
<body>

<div class="container">
  <div class="card" onclick="openPrinter(1)">
    <img src="foto/1.png" alt="Bambu Lab A1">
    <div class="card-title">Принтер 1</div>
    <div class="status-row">
      <div>Статус:</div>
      <div id="main-status-1">Простаивает</div>
    </div>
    <div class="status-row">
      <div>Готово:</div>
      <div id="main-progress-1">0%</div>
    </div>
    <div class="status-row">
      <div>Осталось:</div>
      <div id="main-time-1">0с</div>
    </div>
    <div class="progress">
      <div id="main-bar-1" class="progress-bar"></div>
    </div>
  </div>
</div>

<script>
// ===== ОБЪЕКТ ПРИНТЕРА ИЗ localStorage =====
function getPrinterData() {
  return {
    status: localStorage.getItem("printerStatus") || "idle",
    printName: localStorage.getItem("printerPrintName") || "",
    totalSeconds: parseInt(localStorage.getItem("printerTotalSeconds")) || 0,
    elapsed: parseInt(localStorage.getItem("printerElapsed")) || 0
  };
}

// ===== ОБНОВЛЕНИЕ КАРТОЧКИ =====
function updateCard() {
  let printer = getPrinterData();
  document.getElementById("main-status-1").textContent = printer.status === "idle" ? "Простаивает" : printer.status === "printing" ? "Печать" : "Печать остановлена";
  let progressPercent = printer.totalSeconds ? Math.floor((printer.elapsed / printer.totalSeconds) * 100) : 0;
  document.getElementById("main-progress-1").textContent = progressPercent + "%";
  let remaining = printer.totalSeconds - printer.elapsed;
  document.getElementById("main-time-1").textContent = printer.status==="printing" ? remaining + "с" : "0с";
  document.getElementById("main-bar-1").style.width = progressPercent + "%";
}

// ===== ТАЙМЕР ОБНОВЛЕНИЯ UI =====
setInterval(updateCard, 1000);

// ===== Переход к странице принтера =====
function openPrinter(id){
  window.location.href = "printer.html";
}

// Инициализация
updateCard();
</script>

</body>
</html>
