<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ферма 3D-принтеров</title>
<style>
body{margin:0;background:#1e1e1e;color:#fff;font-family:Arial,sans-serif;}
.container{display:grid;grid-template-columns:repeat(2,1fr);gap:24px 24px;padding:24px;} /* горизонт и вертикальный зазор одинаковый */
.printer-block{background:#2a2a2a;border-radius:40px;overflow:hidden;cursor:pointer;transition:transform 0.15s;display:flex;flex-direction:column;}
.printer-block:active{transform:scale(0.97);}
.printer-photo img{width:100%;height:auto;object-fit:contain;border-bottom:1px solid #444;}
.printer-info{padding:12px;display:flex;align-items:center;justify-content:space-between;}
.printer-name{font-size:18px;font-weight:bold;}
.color-circle{width:16px;height:16px;border-radius:50%;background:red;}
.progress{margin-top:8px;height:12px;background:#444;border-radius:6px;overflow:hidden;}
.progress-bar{height:100%;width:0%;background:#4caf50;transition:width 0.3s;}
.status-printing{margin-top:6px;font-size:16px;opacity:0.8;}
</style>
</head>
<body>

<div class="container" id="printers-container">
  <!-- Блоки принтеров создаются через JS -->
</div>

<script>
const printersContainer = document.getElementById("printers-container");

function getPrinterData(){
  return [{
    id: 1,
    name: "Принтер 1",
    photo: "foto/1.png",
    status: localStorage.getItem("printerStatus") || "idle",
    printName: localStorage.getItem("printerPrintName") || "—",
    totalSeconds: parseInt(localStorage.getItem("printerTotalSeconds")) || 0,
    startTime: parseInt(localStorage.getItem("printerStartTime")) || 0,
    savedPercent: parseInt(localStorage.getItem("printerSavedPercent")) || 0,
    color: localStorage.getItem("printerColor") || "red"
  }];
}

function renderPrinters(){
  const printers = getPrinterData();
  printersContainer.innerHTML = "";
  const now = Date.now();

  printers.forEach(p=>{
    let elapsed = 0;
    if(p.status==="printing") elapsed = Math.floor((now - p.startTime)/1000);
    else if(p.status==="stopped") elapsed = Math.floor(p.totalSeconds * p.savedPercent / 100);

    const percent = p.totalSeconds ? Math.floor((elapsed/p.totalSeconds)*100) : 0;

    const block = document.createElement("div");
    block.className="printer-block";
    block.onclick = ()=>location.href="printer.html"; // открыть страницу принтера

    block.innerHTML=`
      <div class="printer-photo"><img src="${p.photo}" alt="${p.name}"></div>
      <div class="printer-info">
        <div class="printer-name">${p.name}</div>
        <div class="color-circle" style="background:${p.color};"></div>
      </div>
      <div class="status-printing">Печатается: ${p.printName}</div>
      <div class="progress"><div class="progress-bar" style="width:${percent}%; background:${p.status==="stopped"?"orange":"#4caf50"}"></div></div>
    `;
    printersContainer.appendChild(block);
  });
}

renderPrinters();
setInterval(renderPrinters,1000);
</script>

</body>
</html>
