
<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Ферма принтеров</title>

<style>
body{margin:0;background:#1e1e1e;font-family:Arial,sans-serif;color:#fff;}
.container{display:flex;flex-wrap:wrap;gap:64px;padding:32px;justify-content:center;}

.card{
  position:relative;
  background:#2a2a2a;
  border-radius:7px;
  width:45%;
  min-width:140px;
  padding:12px;
  cursor:pointer;
}

.card img{
  width:100%;
  height:180px;
  border-radius:7px;
  object-fit:cover;
}

.card-title{
  font-size:20px;
  font-weight:bold;
  margin-top:8px;
  display:flex;
  align-items:center;
  gap:8px;
}

.color-indicator{width:16px;height:16px;border-radius:50%;}

.status-row{
  display:flex;
  justify-content:space-between;
  margin-top:8px;
  font-size:16px;
}

.progress{
  margin-top:8px;
  height:18px;
  background:#444;
  border-radius:9px;
  overflow:hidden;
}

.progress-bar{height:100%;width:0%;}

.add-card{
  border:2px dashed #555;
  display:flex;
  align-items:center;
  justify-content:center;
  flex-direction:column;
  font-size:20px;
  color:#aaa;
}

.add-card:hover{border-color:#0fb6ec;color:#0fb6ec;}

.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.6);
  display:none;
  align-items:center;
  justify-content:center;
}

.modal-box{
  background:#2a2a2a;
  padding:20px;
  border-radius:8px;
  width:300px;
}

.modal-box input{
  width:100%;
  margin-bottom:10px;
  padding:8px;
  background:#1e1e1e;
  border:none;
  color:#fff;
}

.modal-box button{
  width:100%;
  padding:10px;
  background:#4caf50;
  border:none;
  color:#fff;
  font-size:16px;
}
</style>
</head>

<body>

<div class="container" id="container">

  <!-- ===== ГЛАВНЫЙ ПРИНТЕР (НЕ ТРОГАЕМ) ===== -->
  <div class="card" onclick="openPrinter()">
    <img src="foto/1.png">
    <div class="card-title">
      Принтер 1
      <div class="color-indicator" id="main-color-1"></div>
    </div>

    <div class="status-row">
      <div>Статус:</div>
      <div id="main-status-1">Простаивает</div>
    </div>

    <div class="status-row">
      <div>Модель:</div>
      <div id="main-model-1">—</div>
    </div>

    <div class="progress">
      <div id="main-bar-1" class="progress-bar"></div>
    </div>

    <div class="red-badge" id="main-notify-1">1</div>
  </div>

</div>

<!-- ===== МОДАЛКА ===== -->
<div class="modal" id="modal">
  <div class="modal-box">
    <input id="pName" placeholder="Название принтера">
    <input id="pModel" placeholder="Модель">
    <input id="pPhoto" type="file" accept="image/*">
    <button onclick="addPrinter()">Добавить</button>
  </div>
</div>

<script>
/* ===== ПЕРВЫЙ ПРИНТЕР (КАК БЫЛ) ===== */
function getPrinterData(){
  return {
    status: localStorage.getItem("printerStatus")||"idle",
    printName: localStorage.getItem("printerPrintName")||"",
    totalSeconds:+localStorage.getItem("printerTotalSeconds")||0,
    startTime:+localStorage.getItem("printerStartTime")||0,
    savedPercent:+localStorage.getItem("printerSavedPercent")||0,
    color:localStorage.getItem("printerColor")||"red"
  };
}

function savePrinterData(p){
  localStorage.setItem("printerStatus",p.status);
  localStorage.setItem("printerSavedPercent",p.savedPercent);
}

function updateCard(){
  const p=getPrinterData();
  const now=Date.now();
  let percent=p.savedPercent;

  if(p.status==="printing"&&p.totalSeconds){
    const elapsed=Math.floor((now-p.startTime)/1000);
    percent=Math.min(100,Math.floor(elapsed/p.totalSeconds*100));
    p.savedPercent=percent;
    if(percent>=100){p.status="finished";}
  }

  const s=document.getElementById("main-status-1");
  const m=document.getElementById("main-model-1");
  const b=document.getElementById("main-bar-1");

  s.style.color="#fff";
  b.style.animation="none";

  if(p.status==="idle"){s.textContent="Простаивает";b.style.width="0%";b.style.background="#444";m.textContent="—";}
  if(p.status==="printing"){s.textContent="Печать";b.style.width=percent+"%";b.style.background="#4caf50";m.textContent=p.printName;}
  if(p.status==="stopped"){s.textContent="Печать остановлена";s.style.color="orange";b.style.background="orange";}
  if(p.status==="finished"){s.textContent="Готово";s.style.color="#4caf50";b.style.width="100%";b.style.animation="pulse 1s infinite";}
  if(p.status==="repair"){s.textContent="На ремонте";s.style.color="red";b.style.width="100%";b.style.background="red";}

  document.getElementById("main-color-1").style.background=p.color;
  savePrinterData(p);
}
setInterval(updateCard,500);updateCard();

function openPrinter(){location.href="printer.html";}

/* ===== ДОП ПРИНТЕРЫ ===== */
function getExtra(){return JSON.parse(localStorage.getItem("extraPrinters")||"[]");}
function saveExtra(p){localStorage.setItem("extraPrinters",JSON.stringify(p));}

function renderExtra(){
  const c=document.getElementById("container");
  document.querySelectorAll(".extra").forEach(e=>e.remove());

  getExtra().forEach((p,i)=>{
    const d=document.createElement("div");
    d.className="card extra";
    d.innerHTML=`
      <img src="${p.photo}">
      <div class="card-title">${p.name}</div>
      <div class="status-row"><div>Статус:</div><div>Простаивает</div></div>
      <div class="status-row"><div>Модель:</div><div>${p.model}</div></div>
      <div class="progress"><div class="progress-bar" style="width:0%"></div></div>
    `;
    c.appendChild(d);
  });

  const add=document.createElement("div");
  add.className="card add-card extra";
  add.innerHTML="➕<br>Добавить принтер";
  add.onclick=()=>modal.style.display="flex";
  c.appendChild(add);
}

function addPrinter(){
  if(!pName.value||!pPhoto.files[0])return;
  const r=new FileReader();
  r.onload=()=>{
    const p=getExtra();
    p.push({name:pName.value,model:pModel.value,photo:r.result});
    saveExtra(p);
    modal.style.display="none";
    pName.value=pModel.value=pPhoto.value="";
    renderExtra();
  };
  r.readAsDataURL(pPhoto.files[0]);
}

renderExtra();
</script>

</body>
</html>
