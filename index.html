<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Ферма принтеров</title>

<style>
body { margin:0; background:#1e1e1e; font-family: Arial,sans-serif; color:#fff; }
.container { display:flex; flex-wrap:wrap; gap:64px; padding:32px; justify-content:center; }

.card{
  position:relative;
  background:#2a2a2a;
  border-radius:7px;
  width:45%;
  min-width:140px;
  padding:12px;
  cursor:pointer;
}

.card img{width:100%; border-radius:7px; object-fit:contain;}

.card-title{
  font-size:20px;
  font-weight:bold;
  margin-top:8px;
  display:flex;
  align-items:center;
  gap:8px;
}

.color-indicator{width:16px;height:16px;border-radius:50%;}

.status-row{
  display:flex;
  justify-content:space-between;
  margin-top:8px;
  font-size:16px;
}

.progress{
  margin-top:8px;
  height:18px;
  background:#444;
  border-radius:9px;
  overflow:hidden;
}

.progress-bar{
  height:100%;
  width:0%;
}

.red-badge{
  position:absolute;
  top:8px;
  right:8px;
  width:18px;
  height:18px;
  border-radius:50%;
  background:red;
  color:#fff;
  font-size:12px;
  font-weight:bold;
  display:none;
  align-items:center;
  justify-content:center;
}

@keyframes pulse{
  0%{background:#4caf50;}
  50%{background:#00ff00;}
  100%{background:#4caf50;}
}
</style>
</head>

<body>

<div class="container">
  <div class="card" onclick="openPrinter()">
    <img src="foto/1.png">
    <div class="card-title">
      Принтер 1
      <div class="color-indicator" id="main-color-1"></div>
    </div>

    <div class="status-row">
      <div>Статус:</div>
      <div id="main-status-1">Простаивает</div>
    </div>

    <div class="status-row">
      <div>Модель:</div>
      <div id="main-model-1">—</div>
    </div>

    <div class="progress">
      <div id="main-bar-1" class="progress-bar"></div>
    </div>

    <div class="red-badge" id="main-notify-1">1</div>
  </div>
</div>

<script>
function getPrinterData(){
  return {
    status: localStorage.getItem("printerStatus") || "idle",
    printName: localStorage.getItem("printerPrintName") || "",
    totalSeconds: +localStorage.getItem("printerTotalSeconds") || 0,
    startTime: +localStorage.getItem("printerStartTime") || 0,
    savedPercent: +localStorage.getItem("printerSavedPercent") || 0,
    color: localStorage.getItem("printerColor") || "red"
  };
}

function savePrinterData(p){
  localStorage.setItem("printerStatus", p.status);
  localStorage.setItem("printerSavedPercent", p.savedPercent);
}

function updateCard(){
  const p = getPrinterData();
  const now = Date.now();

  const statusEl = document.getElementById("main-status-1");
  const modelEl = document.getElementById("main-model-1");
  const bar = document.getElementById("main-bar-1");
  const notify = document.getElementById("main-notify-1");

  let percent = p.savedPercent;

  if(p.status==="printing" && p.totalSeconds){
    const elapsed = Math.floor((now - p.startTime)/1000);
    percent = Math.min(100, Math.floor(elapsed/p.totalSeconds*100));
    p.savedPercent = percent;

    if(percent>=100){
      p.status="finished";
      p.savedPercent=100;
      savePrinterData(p);
    }
  }

  bar.style.animation="none";
  notify.style.display="none";

  switch(p.status){
    case "idle":
      statusEl.textContent="Простаивает";
      statusEl.style.color="#fff";
      bar.style.width="0%";
      bar.style.background="#444";
      modelEl.textContent="—";
      break;

    case "printing":
      statusEl.textContent="Печать";
      statusEl.style.color="#fff";
      bar.style.width=percent+"%";
      bar.style.background="#4caf50";
      modelEl.textContent=p.printName||"—";
      break;

    case "stopped":
      statusEl.textContent="Печать остановлена";
      statusEl.style.color="orange";
      bar.style.width=percent+"%";
      bar.style.background="orange";
      modelEl.textContent=p.printName||"—";
      break;

    case "finished":
      statusEl.textContent="Готово";
      statusEl.style.color="#4caf50";
      bar.style.width="100%";
      bar.style.background="#4caf50";
      bar.style.animation="pulse 1s infinite";
      notify.style.display="flex";
      modelEl.textContent=p.printName||"—";
      break;

    case "repair":
      statusEl.textContent="На ремонте";
      statusEl.style.color="red";
      bar.style.width="100%";
      bar.style.background="red";
      modelEl.textContent="—";
      break;
  }

  document.getElementById("main-color-1").style.background=p.color;
  savePrinterData(p);
}

setInterval(updateCard,500);
updateCard();

function openPrinter(){
  window.location.href="printer.html";
}
</script>

</body>
</html>
