<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ферма принтеров</title>

<style>
body{
  margin:0;
  background:#1e1e1e;
  font-family:Arial,sans-serif;
  color:#fff;
}

.container{
  display:grid;
  grid-template-columns:repeat(2,1fr);
  gap:32px;
  padding:32px;
  max-width:1000px;
  margin:auto;
}

.card{
  background:#2a2a2a;
  border-radius:7px;
  padding:12px;
  cursor:pointer;
  position:relative;
}

.card img{
  width:100%;
  border-radius:7px;
  object-fit:contain;
}

.card-title{
  font-size:18px;
  font-weight:bold;
  margin-top:8px;
  display:flex;
  align-items:center;
  gap:8px;
}

.color-indicator{
  width:14px;
  height:14px;
  border-radius:50%;
}

.status-row{
  display:flex;
  justify-content:space-between;
  margin-top:6px;
}

.progress{
  margin-top:8px;
  height:16px;
  background:#444;
  border-radius:8px;
  overflow:hidden;
}

.progress-bar{
  height:100%;
  width:0%;
}

@keyframes pulse{
  0%{background:#4caf50;}
  50%{background:#00ff00;}
  100%{background:#4caf50;}
}

/* ➕ ADD CARD */
.add-card{
  display:flex;
  align-items:center;
  justify-content:center;
  flex-direction:column;
  border:2px dashed #555;
  color:#aaa;
  font-size:18px;
}

.add-card:hover{
  border-color:#0fb6ec;
  color:#0fb6ec;
}

/* MODAL */
.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.6);
  display:none;
  align-items:center;
  justify-content:center;
}

.modal-content{
  background:#2a2a2a;
  padding:20px;
  border-radius:8px;
  width:300px;
}

.modal-content input{
  width:100%;
  margin-bottom:10px;
  padding:8px;
  background:#1e1e1e;
  border:none;
  color:#fff;
}

.modal-content button{
  width:100%;
  padding:10px;
  background:#4caf50;
  border:none;
  color:#fff;
  font-size:16px;
  cursor:pointer;
}
</style>
</head>

<body>

<div class="container" id="printers"></div>

<!-- MODAL -->
<div class="modal" id="modal">
  <div class="modal-content">
    <input id="pName" placeholder="Название принтера">
    <input id="pModel" placeholder="Модель принта">
    <input id="pPhoto" type="file" accept="image/*">
    <button onclick="addPrinter()">Добавить</button>
  </div>
</div>

<script>
function getPrinters(){
  return JSON.parse(localStorage.getItem("printers")||"[]");
}

function savePrinters(p){
  localStorage.setItem("printers",JSON.stringify(p));
}

function render(){
  const wrap=document.getElementById("printers");
  wrap.innerHTML="";
  const printers=getPrinters();

  printers.forEach((p,i)=>{
    const card=document.createElement("div");
    card.className="card";
    card.onclick=()=>location.href=`printer.html?id=${i}`;

    card.innerHTML=`
      <img src="${p.photo}">
      <div class="card-title">
        ${p.name}
        <div class="color-indicator" style="background:${p.color}"></div>
      </div>
      <div class="status-row">
        <div>Статус:</div>
        <div style="color:${p.status==='repair'?'red':p.status==='finished'?'#4caf50':'#fff'}">
          ${statusText(p.status)}
        </div>
      </div>
      <div class="status-row">
        <div>Модель:</div>
        <div>${p.model||"—"}</div>
      </div>
      <div class="progress">
        <div class="progress-bar"
          style="
            width:${progressWidth(p)}%;
            background:${progressColor(p)};
            animation:${p.status==='finished'?'pulse 1s infinite':'none'};
          ">
        </div>
      </div>
    `;
    wrap.appendChild(card);
  });

  const add=document.createElement("div");
  add.className="card add-card";
  add.onclick=()=>document.getElementById("modal").style.display="flex";
  add.innerHTML="➕<br>Добавить принтер";
  wrap.appendChild(add);
}

function statusText(s){
  return s==="idle"?"Простаивает":
         s==="printing"?"Печать":
         s==="stopped"?"Остановлен":
         s==="finished"?"Готово":
         "На ремонте";
}

function progressWidth(p){
  if(p.status==="finished"||p.status==="repair") return 100;
  return p.percent||0;
}

function progressColor(p){
  if(p.status==="repair") return "red";
  if(p.status==="stopped") return "orange";
  return "#4caf50";
}

function addPrinter(){
  const name=pName.value.trim();
  if(!name) return;

  const file=pPhoto.files[0];
  const reader=new FileReader();

  reader.onload=()=>{
    const printers=getPrinters();
    printers.push({
      name,
      model:pModel.value,
      photo:reader.result,
      status:"idle",
      percent:0,
      color:"red"
    });
    savePrinters(printers);
    modal.style.display="none";
    render();
  };
  reader.readAsDataURL(file);
}

render();
</script>

</body>
</html>

